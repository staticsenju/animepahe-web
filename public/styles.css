:root {
  color-scheme: dark light;
  --bg:#0d0f12;
  --surface:#15181e;
  --surface-alt:#1d2026;
  --border:#262b33;
  --fg:#eef1f7;
  --fg-dim:#9aa1af;
  --accent:#6366f1;
  --accent-hover:#5054e9;
  --error:#ef4444;
  --warn:#f59e0b;
  --poster-aspect:10/14;
  --episodes-panel-height:240px;
  --player-max-width:1700px;
}
* { box-sizing:border-box; }
html,body {
  margin:0;
  height:100%;
  background:var(--bg);
  color:var(--fg);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;
}
body {
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
header {
  display:flex;
  gap:.75rem;
  align-items:center;
  padding:.85rem 1.2rem;
  background:#13151a;
  border-bottom:1px solid var(--border);
}
header h1 {
  margin:0;
  font-size:1rem;
  letter-spacing:.5px;
  font-weight:600;
  background:linear-gradient(95deg,#fff,#b4bbff);
  -webkit-background-clip:text;
  color:transparent;
}
header input {
  flex:1 1 auto;
  min-width:250px;
  background:#1e2228;
  border:1px solid var(--border);
  color:var(--fg);
  padding:.65rem .85rem;
  border-radius:11px;
  font-size:.9rem;
  outline:none;
}
header input:focus {
  border-color:var(--accent);
  box-shadow:0 0 0 1px var(--accent) inset;
}
button {
  background:var(--accent);
  color:#fff;
  border:none;
  font-weight:600;
  letter-spacing:.4px;
  font-size:.8rem;
  padding:.62rem 1rem;
  border-radius:9px;
  cursor:pointer;
  transition:background .15s,opacity .15s;
  display:inline-flex;
  align-items:center;
  gap:.4rem;
}
button:hover { background:var(--accent-hover); }
button:disabled { opacity:.55; cursor:not-allowed; }
#status {
  font-size:.65rem;
  letter-spacing:.4px;
  opacity:.7;
  white-space:nowrap;
}

/* Selection Screen */
#selectScreen {
  position:relative;
  flex:1;
  display:flex;
  flex-direction:column;
  padding:1.1rem 1.3rem 1.5rem;
  overflow:hidden;
  gap:1rem;
}
#resultsGrid {
  flex:1 1 auto;
  width:100%;
  display:grid;
  gap:1.1rem;
  grid-template-columns:repeat(auto-fill,minmax(190px,1fr));
  overflow:auto;
  padding:.2rem;
  scrollbar-width:thin;
}
.card {
  position:relative;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:18px;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  transition:transform .18s,border-color .25s,box-shadow .25s;
  isolation:isolate;
}
.card-inner {
  position:relative;
  width:100%;
  aspect-ratio:var(--poster-aspect);
  overflow:hidden;
}
.card img {
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  filter:saturate(1.08) contrast(1.02);
  transition:filter .35s,transform .35s;
}
.card:before {
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(to top,rgba(0,0,0,.72) 5%,rgba(0,0,0,.05) 70%);
}
.card:hover {
  transform:translateY(-5px);
  border-color:#3d4252;
  box-shadow:0 8px 24px -10px rgba(0,0,0,.65),0 0 0 1px rgba(255,255,255,.04) inset;
}
.card:hover img {
  filter:saturate(1.22) brightness(1.05);
  transform:scale(1.04);
}
.card .info {
  position:absolute;
  left:0;
  right:0;
  bottom:0;
  padding:.7rem .75rem .75rem;
  display:flex;
  flex-direction:column;
  gap:.35rem;
  z-index:2;
}
.card .title {
  font-size:.78rem;
  font-weight:600;
  letter-spacing:.4px;
  line-height:1.15;
  max-height:2.3em;
  overflow:hidden;
}
.card .meta {
  font-size:.55rem;
  opacity:.65;
  letter-spacing:.45px;
  display:flex;
  gap:.4rem;
  flex-wrap:wrap;
}
.empty-hint {
  font-size:.75rem;
  opacity:.5;
  letter-spacing:.4px;
  padding:.75rem;
}

body.mode-player #selectScreen { display:none; }

/* Player Screen */
#playerScreen {
  position:relative;
  flex:1;
  display:none;
  flex-direction:column;
  align-items:center;
  overflow:hidden;
}
body.mode-player #playerScreen { display:flex; }

.player-shell {
  position:relative;
  width:100%;
  max-width:var(--player-max-width);
  margin:0 auto;
  display:flex;
  flex-direction:column;
  padding:0 1.3rem;
  box-sizing:border-box;
  height:calc(100% - var(--episodes-panel-height));
}
.player-top-bar {
  display:flex;
  gap:.65rem;
  padding:.85rem 0 .55rem;
  align-items:center;
  flex-wrap:wrap;
}
.player-title {
  font-size:.95rem;
  font-weight:600;
  letter-spacing:.55px;
  display:flex;
  align-items:center;
  gap:.65rem;
}
select {
  background:#1e2228;
  border:1px solid var(--border);
  color:var(--fg);
  font-size:.7rem;
  padding:.55rem .6rem;
  border-radius:9px;
  letter-spacing:.4px;
  min-width:115px;
  outline:none;
}
select:focus {
  border-color:var(--accent);
  box-shadow:0 0 0 1px var(--accent) inset;
}
.player-wrapper {
  flex:1 1 auto;
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
  border-radius:20px;
  overflow:hidden;
  border:1px solid #20242b;
  box-shadow:0 6px 26px -10px rgba(0,0,0,.7),0 0 0 1px rgba(255,255,255,.03) inset;
}
video {
  width:100%;
  height:100%;
  background:#000;
  outline:none;
}
.player-status {
  font-size:.63rem;
  letter-spacing:.45px;
  opacity:.7;
  min-height:1em;
  padding:.25rem 0 .2rem;
}

/* Episodes panel */
#episodesPanel {
  position:relative;
  width:100%;
  max-width:var(--player-max-width);
  margin:0 auto;
  height:var(--episodes-panel-height);
  display:flex;
  flex-direction:column;
  padding:.55rem 1.3rem 1rem;
  box-sizing:border-box;
  gap:.55rem;
}
#episodesPanelHeader {
  display:flex;
  align-items:center;
  justify-content:space-between;
}
#episodesPanelHeader span {
  font-size:.65rem;
  font-weight:600;
  letter-spacing:.5px;
  opacity:.75;
}
.episodes-grid-wrapper {
  position:relative;
  flex:1;
  overflow:auto;
  background:linear-gradient(180deg,#14171c,#181b22);
  border:1px solid #222831;
  border-radius:16px;
  padding:.75rem;
  scrollbar-width:thin;
}
.episodes-grid {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(82px,1fr));
  gap:.55rem;
}
.ep-tile {
  background:#1d2128;
  border:1px solid #2a313b;
  border-radius:11px;
  min-height:70px;
  padding:.45rem .5rem .5rem;
  display:flex;
  flex-direction:column;
  gap:.35rem;
  cursor:pointer;
  transition:background .18s,border-color .18s,transform .18s;
}
.ep-tile:hover {
  background:#262d37;
  border-color:#39414d;
  transform:translateY(-2px);
}
.ep-tile.active {
  background:linear-gradient(140deg,#3f48ff,#6366f1);
  border-color:#6366f1;
  color:#fff;
  box-shadow:0 4px 14px -4px rgba(70,80,255,.55);
}
.ep-num {
  font-size:.66rem;
  font-weight:600;
  letter-spacing:.65px;
}
.ep-meta {
  font-size:.52rem;
  letter-spacing:.4px;
  opacity:.7;
  line-height:1.1;
}
.badge {
  background:#303642;
  padding:2px 6px;
  border-radius:6px;
  font-size:.55rem;
  letter-spacing:.5px;
  font-weight:500;
}

/* Mirror panel */
#mirrorPanel {
  display:none;
  position:absolute;
  top:4.2rem;
  right:1.3rem;
  width:270px;
  max-height:420px;
  background:var(--surface-alt);
  border:1px solid var(--border);
  border-radius:16px;
  padding:.8rem .85rem 1rem;
  box-shadow:0 14px 34px -10px rgba(0,0,0,.75);
  flex-direction:column;
  gap:.7rem;
  z-index:40;
}
#mirrorPanel.active { display:flex; }
.mirror-list {
  display:flex;
  flex-direction:column;
  gap:.55rem;
  overflow:auto;
  scrollbar-width:thin;
}
.mirror {
  background:#232830;
  border:1px solid #303742;
  padding:.55rem .65rem .6rem;
  border-radius:11px;
  font-size:.6rem;
  display:flex;
  flex-direction:column;
  gap:.4rem;
}
.mirror-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:.5rem;
  font-weight:600;
  letter-spacing:.5px;
  font-size:.6rem;
}
.mirror button {
  font-size:.55rem;
  padding:.38rem .6rem;
  border-radius:7px;
  font-weight:600;
  background:#3a4150;
}
.mirror button:hover { background:#4a5262; }

button#refreshMirrorsBtn,
button#reloadPlaylistBtn { background:#394150; }
button#refreshMirrorsBtn:hover,
button#reloadPlaylistBtn:hover { background:#465064; }
button#backBtn,
button#toggleAutoplayBtn { background:#232a34; }
button#backBtn:hover,
button#toggleAutoplayBtn:hover { background:#303743; }
button#closeMirrorPanel { background:#404652; font-size:.55rem; padding:.35rem .6rem; }
button#closeMirrorPanel:hover { background:#4b515c; }

.error { color:var(--error); }

@media (max-width:1100px){
  .player-shell { padding:0 1rem; }
  #episodesPanel { padding:.55rem 1rem 1rem; }
  #mirrorPanel { right:1rem; width:240px; }
  #resultsGrid { grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:.9rem; }
}
@media (max-width:900px){
  .player-top-bar { flex-direction:column; align-items:flex-start; }
  .player-shell { padding:0 .85rem; }
  #episodesPanel { padding:.55rem .85rem 1rem; }
  #mirrorPanel { right:.85rem; top:5rem; }
}
